{% extends "base.html" %}
{% block title %}Memory Games · Dementia Care{% endblock %}
{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <h1 class="h5 mb-0 text-ink-90">Memory Game (Sequence)</h1>
  <a class="btn btn-outline-ink btn-sm" href="{{ url_for('patient_hub') }}">← Back to hub</a>
</div>

<section class="card border-0 shadow-sm rounded-4">
  <div class="card-body p-3 p-md-4">
    <p class="text-ink-60 small mb-3">Watch the tiles blink, then repeat the sequence.</p>
    <div id="board" class="board mb-3">
      <button class="tile t1"></button>
      <button class="tile t2"></button>
      <button class="tile t3"></button>
      <button class="tile t4"></button>
    </div>
    <div class="d-flex gap-2">
      <button id="startBtn" class="btn btn-cta-green btn-sm">Start</button>
      <div id="status" class="small text-ink-80"></div>
    </div>
  </div>
</section>

<script>
  const tiles = Array.from(document.querySelectorAll('.tile'));
  const statusEl = document.getElementById('status');
  const startBtn = document.getElementById('startBtn');
  let seq = [], input = [], busy = false;

  function blink(idx, delay=600){
    return new Promise(res=>{
      setTimeout(()=>{
        tiles[idx].classList.add('active');
        setTimeout(()=>{
          tiles[idx].classList.remove('active'); res();
        }, delay/2);
      }, delay/2);
    });
  }
  async function playSeq(){
    busy = true; statusEl.textContent = 'Watch…';
    for (let i=0;i<seq.length;i++){ await blink(seq[i], 700); }
    busy = false; statusEl.textContent = 'Your turn!';
  }
  function nextRound(){
    seq.push(Math.floor(Math.random()*4));
    input = []; playSeq();
  }
  tiles.forEach((btn, idx)=>{
    btn.addEventListener('click', ()=>{
      if(busy || seq.length===0) return;
      btn.classList.add('active'); setTimeout(()=>btn.classList.remove('active'),150);
      input.push(idx);
      const correct = input[input.length-1] === seq[input.length-1];
      if(!correct){ statusEl.textContent = `Oops! Score: ${seq.length-1}`; seq=[]; input=[]; return;}
      if(input.length===seq.length){ statusEl.textContent = `Great! Score: ${seq.length}`; setTimeout(nextRound, 600); }
    });
  });
  startBtn.addEventListener('click', ()=>{ seq=[]; input=[]; statusEl.textContent='Starting…'; nextRound(); });
</script>

<style>
  :root{ --ink-90:#111827; --ink-80:#1f2937; --green:#16a34a; --yellow:#f59e0b;}
  .text-ink-90{ color:var(--ink-90);} .text-ink-80{ color:var(--ink-80);}
  .btn-cta-green{ background: linear-gradient(90deg, var(--green) 0%, #22c55e 100%); border:0; color:#fff;}
  .rounded-4{ border-radius:1rem; }
  .board{ display:grid; grid-template-columns:repeat(2,120px); gap:12px; }
  .tile{ width:120px; height:120px; border-radius:16px; border:0; box-shadow:0 6px 16px rgba(0,0,0,.12); cursor:pointer; }
  .t1{ background:#fde68a;} .t2{ background:#86efac;} .t3{ background:#93c5fd;} .t4{ background:#fca5a5;}
  .tile.active{ filter:brightness(1.25); transform: scale(1.02); }
</style>
{% endblock %}
