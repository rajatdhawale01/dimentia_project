{% extends "base.html" %}
{% block title %}Medicine Reminder · Dementia Care{% endblock %}
{% block content %}

<div class="d-flex align-items-center justify-content-between mb-3">
  <h1 class="h5 mb-0 text-ink-90">Medicine Reminder</h1>
  <a class="btn btn-outline-ink btn-sm" href="{{ url_for('patient_hub') }}">← Back to hub</a>
</div>

<section class="card border-0 shadow-sm rounded-4">
  <div class="card-body p-3 p-md-4">

    <!-- Add medicine -->
    <form class="row g-2 mb-3" method="post" action="{{ url_for('patient_action') }}">
      <input type="hidden" name="action" value="add_med">
      <div class="col-12 col-md-5">
        <input name="med_name" class="form-control form-control-sm" placeholder="Medicine name (e.g., Donepezil)" required>
      </div>
      <div class="col-7 col-md-3">
        <input name="med_time" class="form-control form-control-sm" placeholder="HH:MM (24h)" pattern="^\\d{2}:\\d{2}$" required>
      </div>
      <div class="col-5 col-md-2">
        <button class="btn btn-cta-green btn-sm w-100" type="submit">Add</button>
      </div>
    </form>

    <!-- List -->
    {% if data.meds %}
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead>
          <tr class="text-ink-70 small">
            <th style="min-width:160px;">Name</th>
            <th style="width:120px;">Time</th>
            <th style="width:140px;">Status</th>
            <th class="text-end" style="width:200px;">Actions</th>
          </tr>
        </thead>
        <tbody>
        {% for m in data.meds %}
          <tr>
            <td class="fw-semibold text-ink-90">{{ m.name }}</td>
            <td><span class="badge bg-light text-ink-80">{{ m.time }}</span></td>
            <td>
              {% if m.taken_today %}
                <span class="badge bg-success">Taken</span>
              {% else %}
                <span class="badge bg-warning text-dark">Pending</span>
              {% endif %}
            </td>
            <td class="text-end">
              <form class="d-inline" method="post" action="{{ url_for('patient_action') }}">
                <input type="hidden" name="action" value="toggle_med">
                <input type="hidden" name="med_id" value="{{ m.id }}">
                <button class="btn btn-sm btn-outline-ink" type="submit">
                  {% if m.taken_today %}Mark pending{% else %}Mark taken{% endif %}
                </button>
              </form>
              <form class="d-inline" method="post" action="{{ url_for('patient_action') }}">
                <input type="hidden" name="action" value="delete_med">
                <input type="hidden" name="med_id" value="{{ m.id }}">
                <button class="btn btn-sm btn-link text-danger" type="submit" title="Delete"><i class="bi bi-trash"></i></button>
              </form>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <div class="text-ink-60 small">No meds yet — add name & time above.</div>
    {% endif %}

    <!-- Today quick summary -->
    <hr class="my-3">
    {% set taken = (data.meds | selectattr('taken_today') | list | length) %}
    {% set total = data.meds | length %}
    <div class="d-flex flex-wrap gap-2 align-items-center small">
      <span class="text-ink-70">Today’s progress:</span>
      <span class="badge bg-success-subtle text-success-emph">{{ taken }}/{{ total }} taken</span>
      {% if total > 0 and taken < total %}
        <span class="text-ink-60">Don’t forget to mark after taking 🌿</span>
      {% endif %}
    </div>

  </div>
</section>

<style>
  :root{ --ink-90:#111827; --ink-80:#1f2937; --ink-70:#334155; --ink-60:#475569; --green:#16a34a; --green-lite:#22c55e; }
  .text-ink-90{ color:var(--ink-90); } .text-ink-80{ color:var(--ink-80); } .text-ink-70{ color:var(--ink-70); } .text-ink-60{ color:var(--ink-60); }
  .btn-cta-green{ background: linear-gradient(90deg, var(--green) 0%, var(--green-lite) 100%); border:0; color:#fff; box-shadow:0 8px 18px rgba(22,163,74,.2); }
  .btn-cta-green:hover{ filter:brightness(.96); color:#fff; }
  .btn-outline-ink{ color:var(--ink-80); border:1px solid rgba(0,0,0,.15); background:#fff; }
  .btn-outline-ink:hover{ color:#fff; background:#111827; border-color:#111827; }
  .bg-success-subtle{ background: rgba(16,185,129,.14)!important; }
  .text-success-emph{ color:#065f46!important; }
  .rounded-4{ border-radius:1rem; }
</style>

{% endblock %}
